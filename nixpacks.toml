providers = ["python"]

[phases.setup]
# Ensure Python + pip exist (Railway previously detected only Node, so pip was missing).
# IMPORTANT: This Railway service runs the Python scraper API (scrapers/api-server.py).
# We intentionally do NOT install Node here; pulling multiple Node versions can cause nix collisions.
nixPkgs = ["python311", "python311Packages.pip"]

[phases.install]
# This repo contains a package.json, but this Railway service does not need Node.
# Override the default `npm i` install phase with a no-op.
cmds = ["echo 'Skipping npm install (python-only service)'"]

[phases.build]
# PEP 668: nixpkgs Python is externally-managed; installing via bare `pip install` fails.
# Install Python deps into a virtualenv that we control, then run the API server using that venv.
cmds = [
  "python -m venv /opt/venv",
  ". /opt/venv/bin/activate && pip install --no-cache-dir -r scrapers/requirements.txt"
]

